<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± ç”¨æˆ·æ³¨å†Œç³»ç»Ÿ</h1>
            <p>é«˜æ•ˆã€å®‰å…¨çš„æ‰¹é‡æ³¨å†Œå·¥å…·</p>
        </div>
        
        <div class="content">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <div class="controls">
                <h2 class="page-title">ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h2>
                <button class="create-btn" onclick="openModal()">
                    <span>â•</span> åˆ›å»ºä»»åŠ¡
                </button>
            </div>
            
            <div class="table-container">
                {% if tasks %}
                    <table>
                        <thead>
                            <tr>
                                <th>ğŸ†” ä»»åŠ¡ID</th>
                                <th>ğŸ« é‚€è¯·ç </th>
                                <th>ğŸ”’ å¯†ç </th>
                                <th>â° åˆ›å»ºæ—¶é—´</th>
                                <th>ğŸ“Š çŠ¶æ€</th>
                                <th>ğŸ”¢ æ€»é‡</th>
                                <th>âœ… å·²å®Œæˆ</th>
                                <th>ğŸ‘¤ å·²å­˜åœ¨</th>
                                <th>â³ å‰©ä½™</th>
                                <th>âš™ï¸ æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in tasks %}
                                <tr>
                                    <td>{{ task.id }}</td>
                                    <td>{{ task.invite_code }}</td>
                                    <td>â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</td>
                                    <td>{{ task.created_at }}</td>
                                    <td>
                                        <span class="task-status {% if task.status == 'completed' %}status-completed{% elif task.status == 'stopped' %}status-stopped{% else %}status-in-progress{% endif %}">
                                            {% if task.status == 'completed' %}âœ… å·²å®Œæˆ{% elif task.status == 'stopped' %}ğŸ›‘ å·²åœæ­¢{% else %}ğŸ”„ è¿›è¡Œä¸­{% endif %}
                                        </span>
                                    </td>
                                    <td>{{ task.total_count }}</td>
                                    <td>{{ task.completed_count }}</td>
                                    <td>{{ task.existing_count }}</td>
                                    <td>{{ task.remaining_count }}</td>
                                    <td>
                                        <button class="action-btn view-btn" onclick="goToTaskDetails('{{ task.id }}')">æŸ¥çœ‹è¯¦æƒ…</button>
                                        {% if task.status == 'running' %}
                                            <button class="action-btn stop-btn" onclick="stopTask('{{ task.id }}')">åœæ­¢</button>
                                        {% elif task.status == 'stopped' %}
                                            <button class="action-btn start-btn" onclick="restartTask('{{ task.id }}')">å¼€å§‹</button>
                                        {% endif %}
                                        {% if task.status == 'completed' or task.status == 'stopped' %}
                                            <button class="action-btn stop-btn" onclick="deleteTask('{{ task.id }}')">åˆ é™¤</button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="empty-state">
                        <p>ğŸ“­ æš‚æ— ä»»åŠ¡</p>
                        <p>è¯·åˆ›å»ºç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹ä½¿ç”¨</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 class="modal-title">ğŸ“‹ åˆ›å»ºæ–°ä»»åŠ¡</h2>
            <form method="POST" action="{{ url_for('create_task_route') }}">
                <div class="form-group">
                    <label for="invite_code">é‚€è¯·ç ï¼š</label>
                    <input type="text" id="invite_code" name="invite_code" required placeholder="è¯·è¾“å…¥é‚€è¯·ç ">
                </div>
                
                <div class="form-group">
                    <label for="password">å¯†ç ï¼š</label>
                    <input type="password" id="password" name="password" required placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                
                <div class="form-group">
                    <label for="min_delay">æœ€å°å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰ï¼š</label>
                    <input type="number" id="min_delay" name="min_delay" value="1" min="0" required placeholder="æœ€å°å»¶è¿Ÿæ—¶é—´">
                </div>
                
                <div class="form-group">
                    <label for="max_delay">æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰ï¼š</label>
                    <input type="number" id="max_delay" name="max_delay" value="5" min="0" required placeholder="æœ€å¤§å»¶è¿Ÿæ—¶é—´">
                </div>
                
                <div class="form-group">
                    <label for="phone_text">æ‰‹æœºå·åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼š</label>
                    <textarea id="phone_text" name="phone_text" required placeholder="è¯·è¾“å…¥æ‰‹æœºå·ï¼Œæ¯è¡Œä¸€ä¸ª&#10;ä¾‹å¦‚ï¼š&#10;13800138000&#10;13900139000&#10;15600156000"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="modal-btn submit-btn">åˆ›å»ºä»»åŠ¡</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
</body>
</html>